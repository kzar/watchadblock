  <script>
    $(function() {
      // Check or uncheck each option.
      extension_call('get_optional_features', {}, function(features) {
        for (var name in features) {
          $("#enable_" + name).
            attr("checked", features[name].is_enabled);
        }
        $("input.feature:checkbox").change(function() {
          var is_enabled = $(this).is(':checked');
          var name = this.id.substring(7); // TODO: hack
          extension_call(
            'set_optional_feature', 
            {name:name, is_enabled:is_enabled}
          );
        });
      });
      
      //translation
      localizePage();

      //clicking the checkbox label checks the checkbox
      $('.optionDescription').click(checkboxlabel_clicked);
    });
  </script>

  <div class="section" class="experiments">
    <h2 i18n="generaloptions"></h2>

    <div id="chromebutton" style="display:none">
      <table>
        <tr>
          <td><input type="checkbox" /></td>
          <td i18n="chromebutton_showoption"></td>
          <td><img src="/img/icon_screenshot.png"/></td>
        </tr>
      </table>
      <div id="chromebutton_upon_check" style="display:none; font-style: italic" class="info">
        <div i18n="chromebutton_how_to_enable" 
             i18n_replacement_el="chromebutton_install_link"></div>
        <a id="chromebutton_install_link" 
           href="https://clients2.google.com/service/update2/crx?response=redirect&x=id%3Dpicdndbpdnapajibahnnogkjofaeooof%26uc%26lang%3Den-US&prod=chrome"></a>
        <div i18n="chromebutton_how_to_disable" style="display:none"></div>
      </div>
    </div>
    <script>
      $(function() {
        if (SAFARI)
          return;
        $("#chromebutton").show();
        $("#chromebutton input").click(function() {
          $("#chromebutton_upon_check").show();
        });
        chrome.extension.sendRequest(button_extension_id, {}, function() {
          $("#chromebutton input").attr("checked", true);
          $("#chromebutton_how_to_enable").hide();
          $("#chromebutton_how_to_disable").show();
        });
      });
    </script>

    <p id="chromeblock" style="display:none">
      <input type="checkbox" class="feature" id="enable_true_blocking_support" />
      <span class="optionDescription" i18n="blocknothideoption"></span>
      <span style='font-style:italic; color:red' i18n="betalabel"></span>
      <br/>
      <span style='font-style:italic; font-size: 12px; margin-left: 25px;' i18n="blocknothidewarning">
      </span>
    </p>
    <script>
      $(function() {
        if (!SAFARI) {
          $("#chromeblock").show();
        }
      });
    </script>

    <p>
      <input type="checkbox" class="feature" id="enable_show_google_search_text_ads"/>
      <span class="optionDescription" i18n="googletextads"></span>
    </p>
    <script>
      // TODO: This is a dumb race condition, and still has a bug where
      // if the user reloads/closes the options page within a second
      // of clicking this, the filters aren't rebuilt.  Call this inside
      // the feature change handler if it's this checkbox being clicked.
      $("#enable_show_google_search_text_ads").change(function() {
        // Give the optional feature a sec to get saved by the other
        // change handler before recalculating filters.
        window.setTimeout(function() { 
          extension_call('update_filters', { }); 
        }, 1000);
      });
    </script>

    <p>
      <input type="checkbox" class="feature" id="enable_show_context_menu_items" />
      <span class="optionDescription" i18n="showcontextmenus"></span>
    </p>

    <p>
      <input type="checkbox" class="feature" id="enable_block_youtube" />
      <span class="optionDescription" i18n="youtubeads"></span>
      <span style='font-style:italic; color:red' i18n="betalabel"></span>
    </p>
  </div>

  <div class="sneaky">
    <input type="checkbox" class="feature" id="enable_debug_logging" />
    <span class="optionDescription" i18n="debuginlogoption"></span>
    <br/>
    <input type="checkbox" class="feature" id="enable_debug_time_logging" />
    <span class="optionDescription" i18n="timeinlogoption"></span>
  </div>
