  <script>
    var originaltext = "";
    
    $("#btnSaveAdvancedFilters").click(function() {
      var text = $("#txtFiltersAdvanced").val();

      extension_call("set_custom_filters_text", { filters: text });

      $("#lblSaveWarning").css("display", "none");
      $("#btnSaveAdvancedFilters").attr("disabled", "disabled");
      originaltext = text;
    });
    
    extension_call('storage_get', {key: "custom_filters", value: ''}, 
                   function(text) {
      $("#txtFiltersAdvanced").val(text);
      originaltext = $("#txtFiltersAdvanced").val();
    });
    
    $("#txtFiltersAdvanced").keyup(function() {
      if ($("#txtFiltersAdvanced").val() == originaltext) {
        $("#lblSaveWarning").css("display", "none");
        $("#btnSaveAdvancedFilters").attr("disabled", "disabled");
      } else {
        $("#lblSaveWarning").css("display", "inline");
        $("#btnSaveAdvancedFilters").attr("disabled", null);
      }
    });
  </script>

  <div class="section">
    <h2>Custom filters</h2>
    <p>
      Most of the time you'll find all the options you need on the 
      filter list, blacklist or whitelist tabs,<br/>
      but you might ever need to have a special filter. You can add it here:
    </p>
    <p class="footnote">
      Be careful: if you make a mistake here a lot of other filters,
      including the official filters, could get broken too!<br/>
      If you need some help with the filter syntax: please take a look at
      <a href="http://adblockplus.org/en/filters" target="_new">this page</a>!
    </p>
    <div>
      <textarea id="txtFiltersAdvanced" cols="112" rows="15" style="font-size:12px;"></textarea>
      <br/>
      <input value="Save!" type="button" id="btnSaveAdvancedFilters" disabled="disabled"/>
      <span id="lblSaveWarning" style="color:red;margin-left:20px;display:none;">
        <b>Don't forget to save!</b>
      </span>
    </div>
  </div>
