<html>
  <head>
    <title>AdBlock Options</title>
    <link rel="stylesheet" href="options.css" />
    <link rel="stylesheet" href="../jquery/css/custom-theme/jquery-ui-1.8.custom.css" />
    <script src="../port.js"></script>
    <script src="../jquery/jquery-1.4.2.min.js"></script>
    <script src="../jquery/jquery-ui-1.8.custom.min.js"></script>
    <script src="../functions.js"></script>
    <script src="../broadcast_channel.js"></script>
    <script>
      listen_for_broadcasts('options_page');

      function note_visit() {
        if (localStorage.getItem('visited_options_at') != null)
          return;
        var now = new Date().getTime();
        localStorage.setItem('visited_options_at', now);
        var installed_at = localStorage.getItem('installed_at', 0);
        if (installed_at == null)
          installed_at = 2; // aka "we don't know"
        $.get("http://chromeadblock.com/api/visit.php", 
              {options_at:now, installed_at:installed_at});
      }

      function displayVersionNumber() {
        try {
          var xhr = new XMLHttpRequest(); 
          xhr.open("GET", chrome.extension.getURL('manifest.json'), false);
          xhr.onreadystatechange = function() { 
            if(this.readyState == 4) { 
              var theManifest = JSON.parse(this.responseText);
              $("#version_number").text(theManifest.version);
            } 
          }; 
          xhr.send(); 
        } catch (ex) {} // silently fail
      }

      // Check or uncheck each loaded DOM option checkbox according to the 
      // user's saved settings.
      function load_options() {
        // Check or uncheck each option.
        extension_call('get_optional_features', {}, function(features) {
          for (var name in features) {
            $("#enable_" + name).
              attr("checked", features[name].is_enabled);
          }
          $("input.feature:checkbox").change(function() {
            var is_enabled = $(this).is(':checked');
            var name = this.id.substring(7); // TODO: hack
            extension_call(
              'set_optional_feature', 
              {name:name, is_enabled:is_enabled}
            );
          });
        });
      }

      $(function() {
        $("#tabpages").tabs({ spinner: "", cache: true });

        displayVersionNumber();

        $(".icon").css("background-image", "url(" + chrome.extension.getURL("img/icon32.png") + ")");

        note_visit();
      });
    </script>
  </head>
  <body>
    <div style="float:right;"> 
      Version <span id="version_number"></span>
      (<a href="http://code.google.com/p/adblockforchrome/wiki/Changelog" target="_new">changelog</a>) 
    </div>
    <h1 class="icon">AdBlock Options</h1>
    <table>
      <tr>
        <td style="padding-right:10px">
          <a class="donatelink" href="http://chromeadblock.com/paypal_donate/donation.php" target="_new">
            <img src="https://www.paypal.com/en_US/i/btn/btn_donate_LG.gif"
                 title="Hooray! Thank you!"/></a>
        </td>
        <td style="font-style:italic; font-size:14px">
          Do you love AdBlock?  My name's Michael.  I've dropped to a
          less-than-full-time job in order to develop AdBlock and support my
          users.  Please use and enjoy AdBlock, and if you can
          <a class="donatelink" href="http://chromeadblock.com/paypal_donate/donation.php" target="_new">
            make a donation</a>
          of any amount, I'd appreciate it <b>immensely</b> :)
        </td>
      </tr>
    </table>
    <script>
      $(function() {
        if (SAFARI) {
          $(".donatelink").each(function(i, el) {
            el.href += "?browser=safari";
          });
        }
      });
    </script>
    <br/>
    <div style="padding-left:5px; margin-bottom:20px">
      Want to contribute code, bug reports, or ad reports?  We
      <a href="http://code.google.com/p/adblockforchrome/wiki/HowToContribute"
         target="_new">
        need your help!</a>
    </div>

    <div id="tabpages">
         <ul>
             <li><a href="general.html"><span>General</span></a></li>
             <li><a href="filters.html"><span>Filter lists</span></a></li>
             <li><a href="blacklist.html"><span>Blacklist</span></a></li>
             <li><a href="whitelist.html"><span>Excluded sites</span></a></li>
         </ul>
    </div>
  </body>
</html>
