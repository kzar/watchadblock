<html>
  <head>
    <title i18n="installedtitle"></title>
    <link rel="stylesheet" href="../options/options.css" />
    <link rel="stylesheet" href="../jquery/css/custom-theme/jquery-ui-1.8.custom.css" />
    <script src="../port.js"></script>
    <script src="../jquery/jquery-1.4.2.min.js"></script>
    <script src="../jquery/jquery-ui-1.8.custom.min.js"></script>
    <script src="../functions.js"></script>
    <script src="../filtering/myfilters.js"></script>
    <script>
      function displayVersionNumber() {
        try {
          var xhr = new XMLHttpRequest();
          xhr.open("GET", chrome.extension.getURL('manifest.json'), false);
          xhr.onreadystatechange = function() {
            if(this.readyState == 4) {
              var theManifest = JSON.parse(this.responseText);
              $("#version_number").text(translate("optionsversion", [theManifest.version]));
            }
          };
          xhr.send();
        } catch (ex) {} // silently fail
      }

      $(function() {
        displayVersionNumber();

        $(".icon").css("background-image", "url(../img/icon32.png)");

        // Check or uncheck each option.
        extension_call('get_optional_features', {}, function(features) {
          for (var name in features) {
            $("#enable_" + name).
              attr("checked", features[name].is_enabled);
          }
          $("input.feature:checkbox").change(function() {
            var is_enabled = $(this).is(':checked');
            var name = this.id.substring(7); // TODO: hack
            extension_call(
              'set_optional_feature', 
              {name:name, is_enabled:is_enabled}
            );
          });
        });
        
        //translation
        localizePage();

        //clicking the checkbox label checks the checkbox
        $('.optionDescription').click(checkboxlabel_clicked);
      });
    </script>
  </head>
  <body>
    <div style="float:right;"> 
      <span id="version_number"></span>
      (<a href="http://code.google.com/p/adblockforchrome/wiki/Changelog" target="_new" i18n="optionschangelog"></a>) 
    </div>

    <div style="width: 70%; margin:auto">
      <h1 class="icon" i18n="installedtitle"></h1>
      <div style="font-size: large" i18n="installisdone"></div>
      <div class="section">
        <h2 i18n="somequicksetup"></h2>

        <div id="chromebutton" style="display:none">
          <table>
            <tr>
              <td><input type="checkbox" /></td>
              <td i18n="chromebutton_showoption"></td>
              <td><img src="/img/icon_screenshot.png"/></td>
            </tr>
          </table>
          <div id="chromebutton_upon_check" style="display:none; font-style: italic" class="info">
            <div i18n="chromebutton_how_to_enable" 
                 i18n_replacement_el="chromebutton_install_link"></div>
            <a id="chromebutton_install_link" 
               href="https://clients2.google.com/service/update2/crx?response=redirect&x=id%3Dpicdndbpdnapajibahnnogkjofaeooof%26uc%26lang%3Den-US&prod=chrome"></a>
            <div i18n="chromebutton_how_to_disable" style="display:none"></div>
          </div>
        </div>
        <script>
          $(function() {
            if (SAFARI)
              return;
            $("#chromebutton").show();
            $("#chromebutton input").click(function() {
              $("#chromebutton_upon_check").show();
            });
            chrome.extension.sendRequest(button_extension_id, {}, function() {
              $("#chromebutton input").attr("checked", true);
              $('[i18n="chromebutton_how_to_enable"]').hide();
              $('[i18n="chromebutton_how_to_disable"]').show();
            });
          });
        </script>

        <p>
          <input type="checkbox" class="feature" id="enable_show_google_search_text_ads"/>
          <span class="optionDescription" i18n="googletextads"></span>
        </p>
        <script>
          // TODO: This is a dumb race condition, and still has a bug where
          // if the user reloads/closes the options page within a second
          // of clicking this, the filters aren't rebuilt.  Call this inside
          // the feature change handler if it's this checkbox being clicked.
          $("#enable_show_google_search_text_ads").change(function() {
            // Give the optional feature a sec to get saved by the other
            // change handler before recalculating filters.
            window.setTimeout(function() { 
              extension_call('update_filters', { }); 
            }, 1000);
          });
        </script>

        <h2 style="margin-top:30px;height:12px;">Recommended filters</h2><br/>
        <p style="margin:0px;">
          <span class="footnote">In order to block ads, AdBlock must use some filter lists. The following lists are recommended:</span><br/>
          <input type="checkbox" id="adblock_custom" checked="checked" />
          <label for="adblock_custom">Special filters for Chrome and Safari</label><br/>
          <input type="checkbox" id="easylist" checked="checked" />
          <label for="easylist">General filters</label><br/>
          <input type="checkbox" id="localizedfilter" checked="checked" />
          <label for="localizedfilter">Filters optimized for your language <span class="langname"></span></label>
        </p>
        <script>
          function subscribe(list_id, log) {
            var list_url = MyFilters.__subscription_options[list_id].url;
            $.ajax({
              url: list_url,
              success: function(text) {
                if (text && 
                     (text[0] == '!' || text[0] == '[' || text[0] == '(')) {
                  extension_call("subscribe", {id: list_id, text:text});
                  if (log)
                    $.get("http://chromeadblock.com/api/url_subscribe.php", 
                        {url:list_url});
                }
              }
            });
          }
          function unsubscribe(list_id) {
            extension_call("unsubscribe", {id: list_id, del:false});
          }
          function langToList(lang) {
            switch(lang) {
              case 'bg': return 'easylist_plus_bulgarian';
              case 'cs': return 'czech';
              case 'cu': return 'easylist_plus_bulgarian';
              case 'da': return 'danish';
              case 'de': return 'easylist_plus_german';
              case 'es': return 'easylist_plus_spanish';
              case 'fi': return 'easylist_plus_finnish';
              case 'fr': return 'easylist_plus_french';
              case 'he': return 'israeli';
              case 'hu': return 'hungarian';
              case 'it': return 'italian';
              case 'ja': return 'japanese';
              case 'ko': return 'easylist_plun_korean';
              case 'nb': return 'easylist_plus_norwegian';
              case 'nl': return 'dutch';
              case 'nn': return 'easylist_plus_norwegian';
              case 'no': return 'easylist_plus_norwegian';
              case 'pl': return 'easylist_plus_polish'; //sorry for the other polish list
              case 'ro': return 'easylist_plus_romanian';
              case 'ru': return 'russian';
              case 'uk': return 'ukranian';
              case 'vi': return 'easylist_plus_vietnamese';
              case 'zh': return 'chinese';
              default: return '';
            }
          }
          $(function() {
            var language = navigator.language.match(/^([a-z]+).*/i)[1];
            $("#adblock_custom, #easylist").change(function() {
              var subscription = $(this).attr('id');
              if ($(this).is(":checked"))
                subscribe(subscription);
              else
                unsubscribe(subscription);
            });
            var list_for_lang = langToList(language);
            if (!list_for_lang) {
              $("#localizedfilter").next().remove();
              $("#localizedfilter").remove();
            } else {
              $(".langname").text('(' + language.toUpperCase() + ')');
              $("#localizedfilter").change(function() {
                if ($(this).is(":checked"))
                  subscribe(list_for_lang, true);
                else
                  unsubscribe(list_for_lang);
              });
              subscribe(list_for_lang, true);
            }
          });
        </script>
          

        <div style="margin-top:2em" i18n="setotheroptions"></div>
      </div>
      <div id="donate_and_link">
        <div style="font-size: large"
             i18n="donaterequest" i18n_replacement_el="donatelink"></div>
        <a target="_new" id="donatelink"></a>
      </div>
      <script>
        $(function() {
          var donate_link = "http://chromeadblock.com/paypal_donate/donation.php";
          if (SAFARI)
            donate_link += "?browser=safari";
          $("#donate_and_link a").attr('href', donate_link);
        });
      </script>

    </div>
  </body>
</html>
