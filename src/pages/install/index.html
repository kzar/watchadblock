<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title i18n="installedtitle"></title>
    <link rel="stylesheet" href="index.css"/>
    <script src="../../jquery/jquery.min.js"></script>
    <script src="../../port.js"></script>
    <script src="../../functions.js"></script>
    <script>
      // Sanitize query params
      var QPS = (function() {
        var result = {};
        var parts = document.location.search.split('&');
        for (var i = 0; i < parts.length; i++) {
          var kv = parts[i].match(/([a-zA-Z_]+)=([a-zA-Z_0-9\.]*)/);
          if (!kv) continue;
          result[kv[1]] = kv[2];
        }
        return result;
      })();
      var installPageVersion = 1;
      localStorage['saw_install_page'] = installPageVersion;
      $(function() {
        localizePage();

        // Slide cards upon nav link click
        $(".nav a").click(function() {
          var pad = 100; // Make darn sure elements slide offscreen
          $("body").css("overflow", "hidden"); // No scrollbars while sliding things around

          // Control whether things slide to the left or downward
          var edge = $(this).hasClass("down") ? "top" : "left";
          var diameterFn = $(this).hasClass("down") ? "height" : "width";

          // Where new content slides to
          var marker = $("#wrapper").position();

          // Put target card in place offscreen.
          var target = $("#" + this.name);
          // Give the payment card more room.
          if (this.name == 'last-step') {
            marker.top -= 90;
            $("#header").animate({"margin-bottom": 5, "margin-top": 5});
          }
          target.css(marker);
          target.css(edge, $(document)[diameterFn]() + pad);
          target.show();


          // Slide my card off screen
          var myCard = $(this).closest(".card");
          myCard.css("z-index", 1);
          var how = {};
          how[edge] = (myCard[diameterFn]() + pad) * -1;
          myCard.animate(how, function() { myCard.hide(); });

          // Slide target card onscreen
          target.css("z-index", 2);
          var that = this;
          target.animate(marker, function() {
            $("body").css("overflow", "auto");
            if (that.name == "last-step")
              $("#last-step #payment-types").each(function(el) { this.scrollIntoView(true); });
          });

          return false;
        });
      });

      // Called after progress bar finishes
      function begin() {
        var SAFARI = (!/chrome/i.test(navigator.userAgent) && /safari/i.test(navigator.userAgent));
        $("#header").fadeIn();
        var startCard = (SAFARI ? "#start-safari": "#start-chrome");
        $(startCard).css($("#wrapper").position()).fadeIn();
      }
    </script>
  </head>
  <body>
    <div id="header">
      <h1 i18n="now_you_have_adblock_hooray"></h1>
      <span i18n="any_new_tabs_you_open_Will_be_automatically_ad_free"></span>
    </div>

    <div id="wrapper"> <!-- Cards slide within this guy. -->
      <!-- 
        For the curious: in tests, non-technical users are confused by
        AdBlock installing instantaneously, and tend to ignore the
        installation page if it flashes up the instant they install.
        So we delay 3 seconds while they get their bearings.
      -->
      <div id="loading-wrapper">
        <div class="card" id="loading">
          <i i18n="installing_adblock"></i>
          <strong><i id="done" i18n="done" style="display:none"></i></strong>
          <br/><br/>
          <progress id="chrome-loading-progress" value=0 max=1>
            <span id="safari-loading-progress"></span>%
          </progress>
        </div>
        <div id="cleaner-warning">
          <a href="#" i18n="seeing_this_every_time_you_start_your_browser"></a>
        </div>
        <script>
          $(function() {
            $("#cleaner-warning a").click(function() {
              alert(translate("filecleanerwarning"));
            });
          });
        </script>
      </div>
      <script>
        var start = new Date();
        var steps = 0;
        (function() {
          // Show a loading progress indicator for a few seconds while the user
          // gets her bearings.

          var runLength = 2500; // Should take this many ms
          var pctTime = (new Date() - start) / runLength; // Goes from 0 to 1

          // Start slow, then speed up.
          var pctDone = Math.pow(pctTime, 4);

          var bar = $("#chrome-loading-progress");
          if (bar.length > 0) // Chrome
            bar[0].value = pctDone;
          else // Safari
            $("#safari-loading-progress").text(Math.min(100, Math.round(pctDone * 100)));

          if (pctDone < 1) {
            window.setTimeout(arguments.callee, 20);
            return;
          }

          window.setTimeout(function() {
            // Loaded
            $("#loading-wrapper").
              find("#done").fadeIn().end().
              delay(1800).
              fadeOut(function() {
                begin();
              });
          }, 200);
        })();
      </script>

      <div class="card" id="start-chrome">
        <h2 i18n="set_up_adblock"></h2>
        <span i18n="please_fill_out_adblocks_one_question_setup"></span><br/><br/>
        <input type="checkbox" id="showads" />
        <label for="showads" i18n="i_like_googles_text_ads_dont_block_those"></label>
        <div class="nav">
          <a href="#" name="howto" class="left"><span i18n="that_was_easy"></span> &gt;&gt;</a>
        </div>
      </div>
      <script>
        $("#start-chrome.card input").change(function() {
          BGcall("set_setting", "show_google_search_text_ads", this.checked, function() {
            BGcall("update_filters");
          });
        });
      </script>

      <div class="card" id="start-safari">
        <h2 i18n="lets_get_you_set_up"></h2>
        <p i18n="first_turn_on_autoupdate_to_get_bugfixes_as_i_write_them"></p>
        <p i18n="turning_on_autoupdate_is_really_important"></p>
        <div class="nav">
          <a href="#" name="autoupdate-howto" class="down" i18n="show_me_how"></a>
          <a href="#" name="howto" class="left"><span i18n="ok_autoupdate_is_on"></span> &gt;&gt;</a>
        </div>
      </div>

      <div class="card" id="autoupdate-howto">
        <img src="autoupdate.png" style="float:right; margin-left: 20px; margin-bottom: 30px;">
        <h2 i18n="to_turn_on_autoupdate"></h2>
        <ol>
          <li i18n="click_safari_prefs"></li>
          <li i18n="click_extensions"></li>
          <li i18n="click_updates"></li>
          <li i18n="click_install_update_automatically"></li>
        </ol>
        <br/>
        <div class="nav">
          <a href="#" name="howto" class="left"><span i18n="ok_autoupdate_is_on"></span> &gt;&gt;</a>
        </div>
      </div>

      <div class="card" id="howto">
        <h2 i18n="how_to_use_adblock"></h2>
        <p i18n="adblock_auto_removes_ads_thats_all"></p>
        <p i18n="for_more_options_right_click"></p>
        <div class="nav">
          <a class="left" name="last-step" href="#"><span i18n="ok_now_what"></span> &gt;&gt;</a>
        </div>
      </div>

      <div class="card" id="last-step">
        <!-- Default data that will be replaced upon successful AJAX request;
        not l10n'd because hopefully it will never be seen (and the data that
        replaces it won't be l10n'd either.)-->
        <style>
          #last-step.card { width: 400px; margin-top: 50px; }
        </style>
        <h2>Last thing</h2>
        You only pay for AdBlock if you want to.  Please do 
        <a href="http://chromeadblock.com/donate?install=done">pay for AdBlock</a> to 
        fund its development.  Thanks!

        <script>
          $(function() {
            $("#last-step").load("http://chromeadblock.com/donate/install/index.php", $.param(QPS));
          });
        </script>

      </div> <!-- card -->
    </div>
  </body>
</html>

