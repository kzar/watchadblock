<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>AdBlock is now installed!</title>
    <link rel="stylesheet" href="index.css"/>
    <script src="../../jquery/jquery.min.js"></script>
    <script src="../../port.js"></script>
    <script src="../../functions.js"></script>
    <script>
      var installPageVersion = 1;
      localStorage['saw_install_page'] = installPageVersion;
      $(function() {
        // Slide cards upon nav link click
        $(".nav a").click(function() {
          var pad = 100; // Make darn sure elements slide offscreen
          $("body").css("overflow", "hidden"); // No scrollbars while sliding things around

          // Control whether things slide to the left or downward
          var edge = $(this).hasClass("down") ? "top" : "left";
          var diameterFn = $(this).hasClass("down") ? "height" : "width";

          // Where new content slides to
          var marker = $("#wrapper").position();

          // Put target card in place offscreen.
          var target = $("#" + this.name);
          // Give the donation card more room.
          if (this.name == 'last-step') {
            marker.top -= 90;
            $("#header").animate({"margin-bottom": 5, "margin-top": 5});
          }
          target.css(marker);
          target.css(edge, $(document)[diameterFn]() + pad);
          target.show();


          // Slide my card off screen
          var myCard = $(this).closest(".card");
          myCard.css("z-index", 1);
          var how = {};
          how[edge] = (myCard[diameterFn]() + pad) * -1;
          myCard.animate(how, function() { myCard.hide(); });

          // Slide target card onscreen
          target.css("z-index", 2);
          var that = this;
          target.animate(marker, function() {
            $("body").css("overflow", "auto");
            if (that.name == "last-step")
              $("#last-step #payment-types").each(function(el) { this.scrollIntoView(true); });
          });

          return false;
        });
      });

      // Called after progress bar finishes
      function begin() {
        var SAFARI = (!/chrome/i.test(navigator.userAgent) && /safari/i.test(navigator.userAgent));
        $("#header").fadeIn();
        var startCard = (SAFARI ? "#start-safari": "#start-chrome");
        $(startCard).css($("#wrapper").position()).fadeIn();
      }
    </script>
  </head>
  <body>
    <div id="header">
      <h1>Now you have AdBlock!  Hooray!</h1>
      Any new tabs you open will be automatically ad-free.
    </div>

    <div id="wrapper"> <!-- Cards slide within this guy. -->
      <!-- 
        For the curious: in tests, non-technical users are confused by
        AdBlock installing instantaneously, and tend to ignore the
        installation page if it flashes up the instant they install.
        So we delay 3 seconds while they get their bearings.
      -->
      <div id="loading-wrapper">
        <div class="card" id="loading">
          <i>Installing AdBlock...</i>
          <strong><i id="done" style="display:none">done.</i></strong>
          <br/><br/>
          <progress id="chrome-loading-progress" value=0 max=1>
            <span id="safari-loading-progress"></span>%
          </progress>
        </div>
        <div id="cleaner-warning">
          <a href="#">Seeing this every time you start your browser?</a>
        </div>
        <script>
          $(function() {
            $("#cleaner-warning a").click(function() {
              alert(translate("filecleanerwarning"));
            });
          });
        </script>
      </div>
      <script>
        var start = new Date();
        var steps = 0;
        (function() {
          // Show a loading progress indicator for a few seconds while the user
          // gets her bearings.

          var runLength = 2500; // Should take this many ms
          var pctTime = (new Date() - start) / runLength; // Goes from 0 to 1

          // Start slow, then speed up.
          var pctDone = Math.pow(pctTime, 4);

          var bar = $("#chrome-loading-progress");
          if (bar.length > 0) // Chrome
            bar[0].value = pctDone;
          else // Safari
            $("#safari-loading-progress").text(Math.min(100, Math.round(pctDone * 100)));

          if (pctDone < 1) {
            window.setTimeout(arguments.callee, 20);
            return;
          }

          window.setTimeout(function() {
            // Loaded
            $("#loading-wrapper").
              find("#done").fadeIn().end().
              delay(1800).
              fadeOut(function() {
                begin();
              });
          }, 200);
        })();
      </script>

      <div class="card" id="start-chrome">
        <h2>Set up AdBlock</h2>
        Please fill out AdBlock's one-question setup:<br/><br/>
        <input type="checkbox" id="showads" />
        <label for="showads">I like Google's text ads; don't block those.</label>
        <div class="nav">
          <a href="#" name="howto" class="left">That was easy &gt;&gt;</a>
        </div>
      </div>
      <script>
        $("#start-chrome.card input").change(function() {
          BGcall("set_setting", "show_google_search_text_ads", this.checked, function() {
            BGcall("update_filters");
          });
        });
      </script>

      <div class="card" id="start-safari">
        <h2>Let's get you set up!</h2>
        <p>
        First, you should <b>turn on autoupdate</b> under Safari Preferences, so you get bugfixes and 
        new features as I write them.
        </p>
        <p>
          Turning on autoupdate is <strong>really important!</strong>
        </p>
        <div class="nav">
          <a href="#" name="autoupdate-howto" class="down">Show me how</a>
          <a href="#" name="howto" class="left">OK, autoupdate is on &gt;&gt;</a>
        </div>
      </div>

      <div class="card" id="autoupdate-howto">
        <img src="autoupdate.png" style="float:right; margin-left: 20px; margin-bottom: 30px;">
        <h2>To turn on autoupdate:</h2>
        <ol>
          <li>Click <b>Safari -&gt; Preferences</b>.</li>
          <li>Click <b>Extensions</b> near the top right.</li>
          <li>At the bottom left, click <b>Updates</b>.</li>
          <li>Click the <b>Install Updates Automatically</b> checkbox.</li>
        </ol>
        <br/>
        <div class="nav">
          <a href="#" name="howto" class="left">OK, autoupdate is on &gt;&gt;</a>
        </div>
      </div>

      <div class="card" id="howto">
        <h2>How to use AdBlock:</h2>
        <p>
          AdBlock automatically removes ads.  That's all there is to it.
        </p>
        <p>
          You can right click web pages, or click the <img src="../../img/icon19.png"/> toolbar button for 
          more options.
        </p>
        <div class="nav">
          <a class="left" name="last-step" href="#">OK, now what? &gt;&gt;</a>
        </div>
      </div>

      <div class="card" id="last-step">
        <!-- Default data that will be replaced upon successful AJAX request. -->
        <style>
          #last-step.card { width: 400px; margin-top: 50px; }
        </style>
        <h2>Last thing</h2>
        AdBlock is free, but would you mind <a href="http://chromeadblock.com/donate?install=done">donating</a>
        to fund its development?  Thanks!

        <script>
          $(function() {
            $("#last-step").load("http://chromeadblock.com/donate/install/g1.html");
          });
        </script>

      </div> <!-- card -->
    </div>
  </body>
</html>

