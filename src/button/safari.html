<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" href="popup.css"/>
    <script src="../jquery/jquery.min.js"></script>
    <script src="../functions.js"></script>
    <script>
      // Set menu entries appropriately for the selected tab.
      function customize_for_this_tab() {
        $(".menu-entry, .separator").hide();
    
        BGcall("get_settings", function(settings) {
          var shown = {};
          function show(L) { L.forEach(function(x) { shown[x] = true;  }); }
          function hide(L) { L.forEach(function(x) { shown[x] = false; }); }

          show(["div_options", "separator2"]);
          if (localStorage.getItem('adblock_is_paused')) {
            show(["div_status_paused", "separator0", "div_options"]);
          } else {
            show(["div_pause_adblock", "div_blacklist", "div_whitelist", 
                  "div_whitelist_page", "div_show_resourcelist", 
                  "div_report_an_ad", "separator1", "div_options", 
                  "div_help_hide_start", "separator3"]);
          }
          if (!settings.show_advanced_options)
            hide(["separator3", "div_show_resourcelist", "div_report_an_ad"]);

          for (var div in shown)
            if (shown[div]) 
              $('#' + div).show();
        });
      }

      $(function() {
        customize_for_this_tab();
      });
    </script>
  </head>
  <body>
    <div id="wrapper">
      <div id="menu-items">

        <div id="titletext"><span>AdBlock</span></div>
        <script>
          $("#titletext span").click(function() {
            var url = "https://chrome.google.com/webstore/detail/gighmmpiobklfepjocnamgkkbiglidom";
            chrome.tabs.create({url:url});
          });
        </script>


        <!-- ***************** New release notification **************** -->

        <div id="div_new_release" style="display:none;">
          <div class="box-wrapper">
            <div class = "box">
              <div id="new_release_close" style="float:right;"><a class="blue" href="#">x</a></div>
              <div id="newtitle"></div>
              <script>$("#newtitle").text(translate("newtitle", ["2.3.0"]));</script>
              <div id="newversioninfo">
              </div>
            </div>
          </div>
          <div class="separator"></div>
        </div>
        <script>
          $(function() {
            BGcall("get_version_to_notify", function(info_ver) {
              // If there was badge text set, informing the user of a new
              // version, clear it.
              localStorage.setItem('saw_badge_version', info_ver);

              if (localStorage.getItem('saw_badge_info_version') != info_ver) {
                // If the user hasn't dismissed the latest notice, show it.
                $("#div_new_release").show();

                $("#new_release_close").click(function() {
                  $("#div_new_release").slideUp();
                  localStorage.setItem('saw_badge_info_version', info_ver);
                });
              }
            });
          });
        </script>


        <!-- ************ Standard menu entries *********** -->

        <div id="div_status_paused" class="menu-entry">
          <span i18n="status_paused" style="font-style:italic;"></span>
          <a i18n="unpause" href="#" class="blue"></a>
        </div>
        <script>
          $(function() {
            $("#div_status_paused a").click(function() {
              localStorage.removeItem('adblock_is_paused');
              window.close();
            });
          });
        </script>



        <div id="separator0" class="separator"></div>

        <div i18n="pause_adblock" id="div_pause_adblock" class="menu-entry">
        </div>
        <script>
          $("#div_pause_adblock").click(function() {
            localStorage.setItem('adblock_is_paused', true);
            window.close();
          });
        </script>


        <div id="separator1" class="separator"></div>


        <!-- **************** Extras ************** -->

        <div i18n="options" id="div_options" class="menu-entry">
        </div>
        <script>
          $("#div_options").click(function() {
            chrome.tabs.create({url:chrome.extension.getURL("options/index.html")});
          });
        </script>

        <div id="div_help_hide">
          <div id="div_help_hide_start" i18n="hide_this_button" class="menu-entry"></div>
          <div id="help_hide_explanation" class="info" i18n="safaributton_how_to_hide" style="display:none;">
          </div>
        </div>
        <script>
          $("#div_help_hide").click(function() {
            $("#help_hide_explanation").slideDown();
          });
        </script>

        <div class="separator" id="separator2"></div>
      </div> <!-- menu-items-->

      <div id="div_pay">
        <div style="margin: 5px 0">
          <div id="pay_close" style="float:right; display:none;"><a class="blue" href="#">x</a></div>
          <a href="#" class="blue" id="pay_open"
            i18n="did_you_know_this_is_my_full_time_job"></a>
        </div>
        <div id="payment_wrapper" style="display:none; clear:left;">
          <iframe width="100%" height="100%" frameBorder=0></iframe>
        </div>
      </div>
      <script>
        $(function() {
          var state = "initial";
          var bodysize = { width: $("body").width(), height: $("body").height() };
          var payHref = "http://chromeadblock.com/pay/?source=P&small=true";
          BGcall("get_statistics", function(stats) {
            payHref = payHref + "&" + $.param(stats);
          });
          $("#pay_open").click(function() {
            if (state == "initial") {
              $("#payment_wrapper iframe").attr("src", payHref);
            }
            if (state == "open")
              return;
            state = "open";
            $("#pay_close").show();
            $("body").animate({width: 780, height: 490}, {queue:false});
            $("#menu-items").slideUp();
            $("#payment_wrapper").
              width(0).height(0).show().
              animate({width: 730, height: 450}, {queue:false});
          });
          $("#pay_close").click(function() {
            if (state != "open")
              return;
            state = "closed";
            $("body").animate(bodysize, {queue:false});
            $("#menu-items").slideDown();
            $("#payment_wrapper").animate({width: 0, height: 0}, {queue:false});
            $("#pay_close").hide();
            $("#payment_wrapper").slideUp();
          });
        });
      </script>

      <script>
        $(function() {
          localizePage();
        });
      </script>
    </div>
  </body>
</html>
