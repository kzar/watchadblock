<html>
  <head>
    <link rel="stylesheet" href="popup.css"/>
    <script src="../jquery/jquery-1.4.2.min.js"></script>
    <script src="../functions.js"></script>
    <script>
      function add_menu_entry(text, action) {
        $("<div>", {"class":"menu-entry"}).
          text(text).
          click(action).
          appendTo("#main");
      }

      // Set menu entries appropriately for the selected tab.
      function customize_for_this_tab() {
        getCurrentTabInfo(function(info) {
          if (info.whitelisted) {
            $("#div_whitelist").add("#div_blacklist").hide();
            $("#div_whitelisted").show();
          }
          if (info.domain.length > 25) {
            info.domain = info.domain.substring(0, 17) + "..." +
                info.domain.substring(info.domain.length - 5);
          }
          $(".domainspan").text(info.domain);
        });
      }

      $(function() {
        $("#titletext").click(function() {
          var url = "https://chrome.google.com/extensions/detail/" +
              adblock_extension_id;
          chrome.tabs.create({url:url});
        });
        $("#div_blacklist").click(function() {
          getCurrentTabInfo(function(info) {
            extension_call(
              'open_blacklist_ui_on_tab',
              {tabid:info.tab.id},
              function() { window.close(); }
            );
          });
        });
        $("#div_whitelist").click(function() {
          getCurrentTabInfo(function(info) {
            extension_call("add_to_whitelist", {domain:info.domain}, function() {
              // Reload the tab
              chrome.tabs.update(info.tab.id, {url: info.tab.url});
              window.close();
            });
          })
        });
        $("#div_whitelisted").click(function() {
          getCurrentTabInfo(function(info) {
            extension_call("remove_from_whitelist", {domain:info.domain}, 
                         function() {
              // Reload the tab
              chrome.tabs.update(info.tab.id, {url: info.tab.url});
              window.close();
            });
          })
        });
        $("#div_options").click(function() {
          chrome.tabs.create({url:chrome.extension.getURL("options/index.html")});
        });
        $("#div_help_disable").click(function() {
          $("#help_disable_explanation").show();
        });

        customize_for_this_tab();
      });

    </script>
  </head>
  <body>
    <div class="wrapper" id="main">
      <h4 id="titletext">AdBlock</h4>
      <div id="div_blacklist" class="menu-entry">
        Block an ad on this page
      </div>
      <div id="div_whitelist" class="menu-entry">
        Don't run on <span class="domainspan">this site</span>
      </div>
      <div id="div_whitelisted" style="display:none" class="menu-entry">
        Block ads on <span class="domainspan">this site</span>
      </div>
      <div id="div_options" class="menu-entry">
        Options
      </div>
      <hr/>
      <div>
        <div id="div_help_disable" class="menu-entry">
          Don't show this button
        </div>
        <div id="help_disable_explanation" class="info" style="display:none">
          <p>
            To hide this button, drag it to the right edge of your extension
            buttons, then click down just to the right of the address bar and
            drag right.
          </p>
        </div>
      </div>
    </div>
  </body>
</html>
