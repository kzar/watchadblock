  <style type="text/css">
    #subscriptionlist {
      margin-top: 10px;
    }
    #subscriptionlist b {
      margin-top: 13px;
      display: block;
    }
    #subscriptionlist list:not(:empty) {
      display: block;
    }
    .listgroup i {
      font-size: 12px;
      margin-left: 20px;
    }
    select {
      width: 100px;
    }
    select + select, select + select + input {
      display: none;
    }
    .linkToList {
      margin-left: 6px;
      font-size: 11px;
      display: none;
    }
    .remove_filter {
      font-size: 11px;
      display: none;
    }
    list {
      margin-left: 20px;
    }
  </style>
  
  <script>
    $(function() {
      var lists = generateSubscriptionInfo();

      var language = navigator.language.match(/^([a-z]+).*/i)[1];
      for (var list in lists) {
        // Set the language_specific list
        if (lists[list].language == language && language != "en")
          $("#easylist").after("<list id='" + list + "'></list>");
      }

      resetLanguageLists();
      resetPrivacyetceteraLists();
      resetCustomLists();
      createListDetails();

      // Set the properties of the language specific section
      function resetLanguageLists() {
        $("#new_language").empty();
        $("#new_language").append("<option disabled='disabled'></option>");
        for (var list in lists) {
          alert(list + "\nlang: " + lists[list].langage );
          if (lists[list].language == undefined || $("list#"+list).length != 0)
            return;
          if (lists[list].subscribed)
            $("#language").append("<list id='" + list + "'></list>");
          else
            $("#new_language").append("<option>" + lists[list].language + "</option>");
        }
      }
      // Set the properties of the section with privacy and other non-
      // adblocking lists
      function resetPrivacyetceteraLists() {
        $("#new_type,#privacyetcetera").empty();
        $("#new_type").append("<option disabled='disabled'></option>");
        for (var list in lists) {
          if (lists[list].type == undefined)
            return;
          if (lists[list].subscribed)
            $("#privacyetcetera").append("<list id='" + list + "'></list>");
          else
            $("#new_type").append("<option>" + lists[list].type + "</option>");
        }
      }
      // Set the properties of the section with custom lists
      function resetCustomLists() {
        $("#customlists").empty();
        for (var list in lists) {
          if (lists[list].type || lists[list].language || list == "adblock_custom")
            return;
          if (/url\:/.test(list))
            $("#customlists").append("<list id='" + list + "'></list>");
        }
      }
      // Fill all <list> entries with their checkboxes etcetera
      function createListDetails() {
        $("list[id]:empty").each(function() {
          var id = $(this).attr("id");
          var list = lists[id];

          var checkbox = $('<input type="checkbox" />').
            attr("id", "subscription" + id);

          var name = $("<label>").
            text(list.name).
            attr("title", list.url).
            attr("for", "subscription" + id);

          var link_to_list = $("<a>").
            attr("target", "_new").
            text(translate('labelshow')).
            addClass("linkToList").
            attr("href", list.url);
            
          var remove_filter_label = $("<a>").
            attr("href", "#").
            text(translate("removefromlist")).
            addClass("remove_filter").
            click(function(event) {
              //...
            });

          $(this).
            append(checkbox).
            append(name).
            append(link_to_list).
            append($("<span></span>").addClass("update_time")).
            append(remove_filter_label);
        });
        
        $(".listgroup:empty").html("<i>You are not subscribed to any lists in this section at the moment</i>");
      }
      // Return a list with all (possible) subscription data
      function generateSubscriptionInfo() {
        var bg = chrome.extension.getBackgroundPage();
        var lists = bg.utils.get_subscriptions_minus_text();
        // Add the language property to default language based lists
        lists.russian.language = "ru";
        lists.easylist_plus_spanish.language = "es";
        lists.easylist_plus_french.language = "fr";
        lists.easylist_plus_german.language = "de";
        lists.italian.language = "it";
        lists.japanese.language = "ja";
        lists.easylist_plun_korean.language = "ko";
        lists.dutch.language = "nl";
        lists.easylist_plus_polish.language = "pl";
        lists.chinese.language = "zh";
        lists.easylist.language = "en";
        // Add the type property to easylist
        lists.easyprivacy.type = "privacyprotection";
        // Add the other 28 subscriptions that were in the top 40
        // TODO
        return lists;
      }
      
      // Translate the page
      localizePage();
    });
  </script>
  <div class="section">
    <h2 i18n="filterstabtitle"></h2>
    <p class="footnote" i18n="filterlistlink" i18n_replacement_el="footnotelink"></p>
    <a id="footnotelink" href="http://adblockplus.org/en/subscriptions" 
       target="_new"></a>
    <span i18n="updatenowmessage" i18n_replacement_el="btnUpdateNow"></span>
    <input type="button" id="btnUpdateNow" />
    <div id="subscriptionlist">
      <b>Recommended lists</b>
      <list id="adblock_custom"></list>
      <list id="easylist"></list>

      <b>Other ad blocking lists for languages</b>
      <div class="listgroup" id="language"></div>
      Select one here: <select id="new_language"></select>
      <select id="new_list_for_language"></select>
      <input type="button" id="add_new_language" i18n_value="subscribebutton" />

      <b>Lists intended for blocking other things than ads</b>
      <div class="listgroup" id="privacyetcetera"></div>
      Select one here: <select id="new_type"></select>
      <select id="new_list_for_type"></select>
      <input type="button" id="add_new_type" i18n_value="subscribebutton" />

      <b>My own personal favorites</b>
      <div class="listgroup" id="customlists"></div>
      Enter one here: <input id="new_custom" style="width:300px;" type="text" />
      <input type="button" id="add_new_custom" i18n_value="subscribebutton" />
    </div>
  </div>
  
  
  <div class="sneaky">
    <p>
    <span i18n="subscribetonone"></span>
    <input type="button" id="btnUnsubscribeAll" i18n_value="buttonok" />
    <br/>
    <span i18n="showlinkstolists"></span> 
    <input type="button" id="btnShowLinks" i18n_value="buttonok" />
    </p>
    <script>
      $(function() {
        $("#btnUnsubscribeAll").click(function() {
          $("input", ".subscription").each(function(i, el) {
            if (el.checked == true) {
              unsubscribe($(el).attr("name"));
            }
          });
        });

        $("#btnShowLinks").click(function() {
          $(".linkToList").css("display", "inline");
          $("#btnShowLinks").attr("disabled", "disabled");
        });
      });
    </script>
  </div>
